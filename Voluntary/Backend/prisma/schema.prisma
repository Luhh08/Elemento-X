// Aqui iremos controlar todas as configurações do banco de dados
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model Usuario {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  nome               String
  usuario            String   @unique
  email              String   @unique
  cpf                String   @unique
  senha              String

  // Validação e segurança
  validacao          Boolean  @default(false)
  validacaoToken     String?
  resetToken         String?
  resetTokenExpires  DateTime?

  // Campos extras de perfil
  descricao          String?         
  competencias       String[]        
  preferenciaHorario String[]        
  emailcontato       String?         
  telefonecontato    String?         

  // URLs de imagens
  bannerUrl          String?   
  fotoUrl            String?   

  isBanned        Boolean   @default(false)
  banReason       String?

  candidaturas Candidatura[]

  avaliacaos Avaliacao[]
  denuncias Denuncia[]
  notificacoes Notificacao[]
}

model Empresa {
  id               String  @id @default(auto()) @map("_id") @db.ObjectId
  razao_social     String
  email            String  @unique
  cnpj             String  @unique
  telefone_empresa String  @unique
  cep              String
  endereco         String
  senha            String

  // Validação e segurança
  validacao          Boolean  @default(false)
  validacaoToken     String?
  resetToken         String?
  resetTokenExpires  DateTime?

  // Relação com representantes
  representantes     RepresentanteLegal[]

  // Perfil público
  usuario          String?  @unique
  descricao         String?                       
  tags              String[] @default([])         
  bannerUrl         String?                       
  logoUrl           String?      
  emailcontato      String?
  telefonecontato   String?    
  vaga              Vaga[]

  isBanned        Boolean   @default(false)
  banReason       String?                              

  respostaAvaliacaos RespostaAvaliacao[]

  denuncias Denuncia[]
  notificacoes Notificacao[]
}

model RepresentanteLegal {
  id                     String   @id @default(auto()) @map("_id") @db.ObjectId
  nome                   String
  cpf                    String   @unique
  cargo                  String
  email_representante    String   @unique
  telefone_representante String   @unique
  empresaId              String?  @db.ObjectId
  empresa Empresa? @relation(fields: [empresaId], references: [id], onDelete: Cascade)

}

model Administrador {
  id       String @id @default(auto()) @map("_id") @db.ObjectId
  usuario  String @unique
  senhaHash String
}

enum VagaStatus {
  ABERTA
  INSCRICOES_FINALIZADAS
  ANDAMENTO
  FINALIZADA
}

model Vaga{

  id          String     @id @default(auto()) @map("_id") @db.ObjectId
  empresaId   String     @db.ObjectId
  titulo      String
  descricao   String
  tags        String[]
  local       String
  turno       String[]   
  status      VagaStatus @default(ABERTA)
  dataInicio  DateTime?
  dataFim     DateTime?
  imagens     String[]   
  aplicacoes  Int        @default(0)
  empresa    Empresa @relation(fields: [empresaId], references: [id], onDelete: Cascade)


  candidaturas Candidatura[]

  avaliacaos Avaliacao[]
}

enum StatusCandidatura {
  INSCRITA
  ACEITA
  RECUSADA
  EM_ANDAMENTO
}

model Candidatura {
  id           String            @id @default(auto()) @map("_id") @db.ObjectId
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  status       StatusCandidatura @default(INSCRITA)
  motivoRecusa String?

  voluntarioId String            @db.ObjectId
  voluntario   Usuario           @relation(fields: [voluntarioId], references: [id])

  vagaId       String            @db.ObjectId
  vaga         Vaga              @relation(fields: [vagaId], references: [id])

  @@unique([vagaId, voluntarioId])
}

model Avaliacao {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  vagaId       String   @db.ObjectId
  voluntarioId String   @db.ObjectId
  nota         Int
  comentario   String?
  fotos        String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  vaga         Vaga     @relation(fields: [vagaId], references: [id], onDelete: Cascade)
  voluntario   Usuario  @relation(fields: [voluntarioId], references: [id], onDelete: Cascade)
  resposta     RespostaAvaliacao? @relation("AvaliacaoResposta")

  @@unique([vagaId, voluntarioId])
}

model RespostaAvaliacao {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  avaliacaoId String   @unique @db.ObjectId
  empresaId   String   @db.ObjectId
  mensagem    String
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  avaliacao   Avaliacao @relation("AvaliacaoResposta", fields: [avaliacaoId], references: [id], onDelete: Cascade)
  empresa     Empresa   @relation(fields: [empresaId], references: [id], onDelete: Cascade)
}

model Denuncia {
  id             String   @id @default(auto()) @map("_id") @db.ObjectId
  tipo           String
  alvoId         String   @db.ObjectId
  quemDenunciouId String?  @db.ObjectId
  quemDenunciou  Usuario? @relation(fields: [quemDenunciouId], references: [id], onDelete: SetNull)
  quemDenunciouEmpresaId String? @db.ObjectId
  quemDenunciouEmpresa   Empresa? @relation(fields: [quemDenunciouEmpresaId], references: [id], onDelete: SetNull)
  mensagem       String
  criadoEm       DateTime @default(now())
  resolvida      Boolean  @default(false)
  adminNota      String?
  reporterNome   String?
  reporterEmail  String?
  reporterTipo   String?
  resultado      String?
}

model Notificacao {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  titulo    String
  mensagem  String
  categoria String?
  link      String?
  usuarioId String?  @db.ObjectId
  usuario   Usuario? @relation(fields: [usuarioId], references: [id], onDelete: Cascade)
  empresaId String?  @db.ObjectId
  empresa   Empresa? @relation(fields: [empresaId], references: [id], onDelete: Cascade)
  lida      Boolean  @default(false)
  criadoEm  DateTime @default(now())
}
